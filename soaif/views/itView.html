<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<slink rel="shortcut icon" href="/favicon.ico?v=1">
		<title>nutshell</title>
		<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
		<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script src="https://cdn.firebase.com/js/client/2.1.2/firebase.js"></script>
		<script src="../../assets/nutshell.js?v=1"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="../../assets/nutshell.css">
<!-- 
		<script src="../../assets/jquery-1.11.2.min.js"></script>
		<script src="../../assets/jquery-migrate-1.2.1.min.js"></script>
		<script src="../../assets/bootstrap.min.js"></script>
		<script src="../../assets/firebase.js"></script>
		<script src="../../assets/nutshell.js?v=1"></script>
		<link rel="stylesheet" href="../../assets/bootstrap.min.css">
		<link rel="stylesheet" href="../../assets/bootstrap-theme.min.css">
		<link rel="stylesheet" href="../../assets/nutshell.css?v=1">
 -->
	</head>
	<body>
		<div class="container" style="margin-top: 70px">
			<div class="row clearfix">
				<div class="col-md-12 column">
					<div class="row clearfix">
						<div class="col-md-6 column slot0">
							x
						</div>
						<div class="col-md-6 column slot1">
y
						</div>
					</div>
					<div class="row clearfix">
						<div class="col-md-12 column auto">
z
						</div>
					</div>
				</div>
			</div>	
		</div>

		<script type="text/javascript">
			/* #nsData */

			var ns = {
				getLayout: function(user) {
				//db.select(query, function(err, results) {
					return {
						name: 'itView',
						_slots: {
							slot: [
								{
									id: 'slot0',
									description: 'topLeft'
								},
								{
									id: 'slot1',
									description: 'topRight'
								}
							]
						},
						get slots() {
							return this._slots.slot; //FIX! create and use .makeArray();
						}
					}
				},
				getViews: function(user) {
					// gets users views/urls plus options
					return {
				 		description: 'default service view',
						_views: {
							view: [
								{
									url: 'http://localhost:8080/nutshell/soaif/services.view',
									location: 'slot0'
								}
							]
						},
						get views() {
							return this._views.view.map(function(item) {
								item.load = function() {
									$('.' + item.location).load(item.url)
									console.log('ss', this);
								};
								return item;
							}); //FIX! create and use .makeArray();
						},
						getBySlotId: function(id) {
							var result;
							this.views.forEach(function(view) {
								if (view.location === id) {
									console.log('matchy', view.load);
									result = view;
									return false;
								}
							});

							if (!result) {
								console.log('not_matchy', this.views[0]);
								result = this.views[0];	
							}

							return result;
						}
					}
				}
			}

			$('document').ready(nutshell(function() {
				var user = {};
				var layoutInfo = ns.getLayout(user);
				var views = ns.getViews(user);

				layoutInfo.slots.forEach(function(slot) {
					console.log('many', slot);
					var view = views.getBySlotId(slot.id);
					console.log(view);
					view.load();
				});
			}));
		</script>
	</body>
</html>